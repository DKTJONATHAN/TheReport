name: ðŸ§ª Twitter cURL Test (No Dependencies)
on: workflow_dispatch

jobs:
  tweet:
    runs-on: ubuntu-latest
    steps:
      - name: LIVE Tweet SpaceX
        env:
          API_KEY: ${{ secrets.TWITTER_CONSUMER_KEY }}
          API_SECRET: ${{ secrets.TWITTER_CONSUMER_SECRET }}
          ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
        run: |
          # OAuth1 signature generation
          TIMESTAMP=$(date +%s)
          NONCE=$(openssl rand -hex 32)
          
          # Base string
          BASE="POST&https%3A%2F%2Fapi.twitter.com%2F2%2Ftweets&"
          PARAMS="oauth_consumer_key%3D$API_KEY%26oauth_nonce%3D$NONCE%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D$TIMESTAMP%26oauth_token%3D$ACCESS_TOKEN%26oauth_version%3D1.0"
          BASE="$BASE$PARAMS"
          
          # Sign
          SIGNING_KEY="$API_SECRET&$TOKEN_SECRET"
          SIGNATURE=$(echo -n "$BASE" | openssl dgst -sha1 -hmac "$SIGNING_KEY" -binary | openssl base64 -A)
          
          curl -X POST https://api.twitter.com/2/tweets \
            -H "Authorization: OAuth oauth_consumer_key="$API_KEY",oauth_nonce="$NONCE",oauth_signature="$SIGNATURE",oauth_signature_method="HMAC-SHA1",oauth_timestamp="$TIMESTAMP",oauth_token="$ACCESS_TOKEN",oauth_version="1.0"" \
            -H "Content-Type: application/json" \
            -d '{
              "text": "ðŸš€ SpaceX 1M Solar Satellites TEST
https://jonathanmwaniki.co.ke/posts/spacex-files-for-1-million-solar-satellite-data-centres
#SpaceX #Test from GitHub"
            }'